name: Run Selenium Tests

on: [push, pull_request]

jobs:
  test:
    # Use Ubuntu image with pre-installed Chrome and Node.js
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Set up Node.js
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 3. Install npm dependencies
      - name: Install dependencies
        run: npm ci

      # 4. Run Selenium tests in headless Chrome via Xvfb
      - name: Run Selenium tests
        run: |
          # Update package lists and install required packages for headless Chrome
          sudo apt-get update
          sudo apt-get install -y xvfb libxi6 libnss3 libxss1 fonts-liberation
          
          # Start virtual display
          Xvfb :99 -screen 0 1280x1024x24 &
          
          # Set DISPLAY environment variable
          export DISPLAY=:99
          
          # Run tests with Mocha
          npx mocha ./test/**/*.js